//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null,i=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[h](a);)c=c.parentNode;return c&&c[h](a)?b.element(c):b.element()},j=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(c,g){return{restrict:"A",scope:!0,compile:function(h){var j,k,l,m,n,o,p=h.children().eq(0),q=p[0].outerHTML,r="$vs_collection",s=!1,t={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};if(p.attr("ng-repeat"))o="ng-repeat",j=p.attr("ng-repeat");else if(p.attr("data-ng-repeat"))o="data-ng-repeat",j=p.attr("data-ng-repeat");else if(p.attr("ng-repeat-start"))s=!0,o="ng-repeat-start",j=p.attr("ng-repeat-start");else{if(!p.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");s=!0,o="data-ng-repeat-start",j=p.attr("data-ng-repeat-start")}if(k=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(j),l=k[1],m=k[2],n=k[3],s)for(var u=0,v=h.children().eq(0);null==v.attr("ng-repeat-end")&&null==v.attr("data-ng-repeat-end");)u++,v=h.children().eq(u),q+=v[0].outerHTML;return h.empty(),{pre:function(h,j,k){function p(){if(!D||D.length<1)return h[r]=[],A=0,x(0),void(h.sizesCumulative=[0]);if(A=D.length,I){h.sizes=D.map(function(a){var c=h.$new(!1);b.extend(c,a),c[l]=a;var d=k.vsSize||k.vsSizeProperty?c.$eval(k.vsSize||k.vsSizeProperty):h.elementSize;return c.$destroy(),d});var a=0;h.sizesCumulative=h.sizes.map(function(b){var c=a;return a+=b,c}),h.sizesCumulative.push(a)}else u();w()}function u(){H&&h.$$postDigest(function(){if(j[0].offsetHeight||j[0].offsetWidth){for(var a=j.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[o]||d){if(c||(h.elementSize=0),c=!0,a[b][M]&&(h.elementSize+=a[b][M]),!s)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(w(),H=!1,h.$root&&!h.$root.$$phase&&h.$apply())}else var e=h.$watch(function(){(j[0].offsetHeight||j[0].offsetWidth)&&(e(),u())})})}function v(){"undefined"!=typeof k.vsAutoresize&&(H=!0,u(),h.$root&&!h.$root.$$phase&&h.$apply()),z()&&h.$apply()}function w(){O=void 0,P=void 0,Q=A,R=0,x(I?h.sizesCumulative[A]:h.elementSize*A),z(),h.$emit("vsRepeatReinitialized",h.startIndex,h.endIndex)}function x(a){h.totalSize=h.offsetBefore+a+h.offsetAfter}function y(){var a=d(J[0],L);a!==S&&(w(),h.$root&&!h.$root.$$phase&&h.$apply()),S=a}function z(){var a=e(J[0],N),b=d(J[0],L),c=j[0]===J[0]?0:f(j[0],J[0],E),i=h.startIndex,k=h.endIndex;if(I){for(i=0;h.sizesCumulative[i]<a-h.offsetBefore-c;)i++;for(i>0&&i--,i=Math.max(Math.floor(i-h.excess/2),0),k=i;h.sizesCumulative[k]<a-h.offsetBefore-c+b;)k++;k=Math.min(Math.ceil(k+h.excess/2),A)}else i=Math.max(Math.floor((a-h.offsetBefore-c)/h.elementSize)-h.excess/2,0),k=Math.min(i+Math.ceil(b/h.elementSize)+h.excess,A);Q=Math.min(i,Q),R=Math.max(k,R),h.startIndex=K.latch?Q:i,h.endIndex=K.latch?R:k;var l=!1;if(null==O?l=!0:null==P&&(l=!0),l||(K.hunked?Math.abs(h.startIndex-O)>=h.excess/2||0===h.startIndex&&0!==O?l=!0:(Math.abs(h.endIndex-P)>=h.excess/2||h.endIndex===A&&P!==A)&&(l=!0):l=h.startIndex!==O||h.endIndex!==P),l){h[r]=D.slice(h.startIndex,h.endIndex),h.$emit("vsRepeatInnerCollectionUpdated",h.startIndex,h.endIndex,O,P),O=h.startIndex,P=h.endIndex;var m=I?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",n=g(m),o=n(h,{$index:0}),p=n(h,{$index:h[r].length}),q=h.totalSize,s=E?"width":"height";F.css(s,o+"px"),G.css(s,q-p+"px")}return l}var A,B=b.element(q),C=B[0].tagName.toLowerCase(),D=[],E="undefined"!=typeof k.vsHorizontal,F=b.element("<"+C+' class="vs-repeat-before-content"></'+C+">"),G=b.element("<"+C+' class="vs-repeat-after-content"></'+C+">"),H=!k.vsRepeat,I=!!k.vsSize||!!k.vsSizeProperty,J=k.vsScrollParent?"window"===k.vsScrollParent?b.element(a):i.call(j,k.vsScrollParent):j,K="vsOptions"in k?h.$eval(k.vsOptions):{},L=E?"clientWidth":"clientHeight",M=E?"offsetWidth":"offsetHeight",N=E?"scrollLeft":"scrollTop";if(h.totalSize=0,!("vsSize"in k)&&"vsSizeProperty"in k&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===J.length)throw"Specified scroll parent selector did not match any element";h.$scrollParent=J,I&&(h.sizesCumulative=[]),h.elementSize=+k.vsRepeat||d(J[0],L)||50,h.offsetBefore=0,h.offsetAfter=0,h.excess=2,E?(F.css("height","100%"),G.css("height","100%")):(F.css("width","100%"),G.css("width","100%")),Object.keys(t).forEach(function(a){k[a]&&k.$observe(a,function(b){h[t[a]]=+b,w()})}),h.$watchCollection(m,function(a){D=a||[],p()}),B.eq(0).attr(o,l+" in "+r+(n?" "+n:"")),B.addClass("vs-repeat-repeated-element"),j.append(F),j.append(B),c(B)(h),j.append(G),h.startIndex=0,h.endIndex=0,J.on("scroll",function(){z()&&h.$digest()}),b.element(a).on("resize",v),h.$on("$destroy",function(){b.element(a).off("resize",v)}),h.$on("vsRepeatTrigger",p),h.$on("vsRepeatResize",function(){H=!0,u()});var O,P,Q,R;h.$on("vsRenderAll",function(){K.latch&&setTimeout(function(){var a=A;R=Math.max(a,R),h.endIndex=K.latch?R:a,h[r]=D.slice(h.startIndex,h.endIndex),P=h.endIndex,h.$$postDigest(function(){var a=E?"width":"height";F.css(a,0),G.css(a,0)}),h.$apply(function(){h.$emit("vsRenderAllDone")})})});var S;h.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(y):y()})}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=j.name)}(window,window.angular);